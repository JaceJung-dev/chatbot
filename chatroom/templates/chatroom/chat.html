<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Chat</title>
    <style>
        .loading {
            font-style: italic;
            color: gray;
        }
    </style>
</head>
<body>
    <h2>WebSocket ì±—ë´‡</h2>
    <div id="chat-box"></div>
    <input type="text" id="message-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
    <button onclick="sendMessage()">ë³´ë‚´ê¸°</button>

    <script>
        const chatroom_id = 1; // ì›í•˜ëŠ” ì±„íŒ…ë°© ID
        const socket = new WebSocket(`ws://127.0.0.1:8000/ws/chatroom/${chatroom_id}/`);

        socket.onopen = function () {
            console.log("âœ… WebSocket ì—°ê²° ì„±ê³µ!");
        };

        socket.onmessage = function (event) {
            const data = JSON.parse(event.data);
            console.log("ğŸ“¨ ì‚¬ìš©ì ë©”ì‹œì§€:", data.user_message);
            console.log("ğŸ¤– ì±—ë´‡ ì‘ë‹µ:", data.bot_message);

            const chatBox = document.getElementById("chat-box");

            if (data.bot_message === "âŒ› ë‹µë³€ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...") {
                // ìƒíƒœ ë©”ì‹œì§€ë¥¼ í‘œì‹œ (ë¡œë”© íš¨ê³¼ ì¶”ê°€)
                chatBox.innerHTML += `<p class="loading" id="loading-message"><b>ì±—ë´‡:</b> ${data.bot_message}</p>`;
            } else {
                // ê¸°ì¡´ "ë‹µë³€ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤..." ë¬¸êµ¬ë¥¼ ëŒ€ì²´
                let loadingMessage = document.getElementById("loading-message");
                if (loadingMessage) {
                    loadingMessage.remove(); // ê¸°ì¡´ ë¡œë”© ë©”ì‹œì§€ ì‚­ì œ
                }
                // ì‹¤ì œ ì±—ë´‡ ì‘ë‹µ ì¶”ê°€
                chatBox.innerHTML += `<p><b>ì±—ë´‡:</b> ${data.bot_message}</p>`;
            }
        };

        function sendMessage() {
            const inputField = document.getElementById("message-input");
            const message = inputField.value;

            // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            const chatBox = document.getElementById("chat-box");
            chatBox.innerHTML += `<p><b>ì‚¬ìš©ì:</b> ${message}</p>`;

            // WebSocketìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡
            socket.send(JSON.stringify({ message: message }));
            inputField.value = "";
        }
    </script>
</body>
</html>
